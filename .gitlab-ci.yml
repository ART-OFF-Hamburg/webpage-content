image: registry.gitlab.com/pages/hugo:latest

stages:
  - setup
  - build
  - deploy

setup_job:
  stage: setup
  script:
    - apk update
    - apk add openssh

build_job:
  stage: build
  script:
    - hugo
  artifacts:
    paths:
    - public
  variables:
    GIT_SUBMODULE_STRATEGY: recursive
  only:
  - master

deploy_job:
  stage: deploy
  script:
    - apk update
    - apk add lftp
    - lftp -c "set ftp:ssl-allow no; open -u $USERNAME,$PASSWORD $HOST; mirror -Rev public/ ./preview  --ignore-time --parallel=10"
